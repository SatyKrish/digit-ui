/* Anti-flicker optimizations for streaming chat */
.streaming-message {
  transform: translateZ(0); /* Force hardware acceleration */
  backface-visibility: hidden; /* Prevent flicker during transitions */
  will-change: auto; /* Reset will-change after streaming */
}

.streaming-message.is-streaming {
  will-change: contents; /* Optimize for content changes */
}

.chat-container {
  transform: translateZ(0); /* Force hardware acceleration for container */
  contain: layout style; /* Optimize rendering containment */
}

.message-content {
  word-wrap: break-word;
  overflow-wrap: break-word;
  hyphens: auto;
  /* Prevent content from jumping during streaming */
  min-height: 1.5rem;
  /* Better handling of wide content */
  max-width: 100%;
  overflow-x: auto;
}

/* Enhanced message bubble styling */
.message-bubble {
  contain: layout;
  transform: translateZ(0);
  /* Ensure stable sizing during streaming */
  box-sizing: border-box;
  /* Better text handling */
  word-wrap: break-word;
  overflow-wrap: break-word;
  max-width: 100%;
  min-width: 0;
  overflow-wrap: anywhere;
  word-break: break-word;
  hyphens: auto;
}

/* Reduce reflow during streaming */
.streaming-container {
  contain: layout style;
  transform: translateZ(0);
}

/* Optimize scroll performance */
.chat-scroll-area {
  scroll-behavior: auto; /* Disable smooth scroll during streaming */
  overscroll-behavior: contain;
  /* Improve scroll performance */
  will-change: scroll-position;
}

.chat-scroll-area.streaming {
  scroll-behavior: auto;
  /* Reduce repaints during streaming */
  contain: strict;
}

.message-bubble.streaming {
  min-height: 2.5rem; /* Prevent height jumps */
  /* Optimize for content changes */
  will-change: contents;
}

/* Optimize avatar rendering */
.message-avatar {
  transform: translateZ(0);
  contain: layout style;
}

/* Reduce animation impact during streaming */
.streaming-message.is-streaming .animate-slide-in-up {
  animation: none;
}

.streaming-message.is-streaming .animate-stagger-1,
.streaming-message.is-streaming .animate-stagger-2,
.streaming-message.is-streaming .animate-stagger-3,
.streaming-message.is-streaming .animate-stagger-4 {
  animation: none;
}

/* Optimize markdown rendering during streaming */
.streaming .prose {
  contain: layout style;
}

/* Prevent typography shifts */
.streaming .prose p {
  margin-bottom: 0.75rem;
  margin-top: 0;
}

/* Stable loading indicator */
.loading-indicator {
  contain: layout;
  transform: translateZ(0);
}

/* Layout overflow prevention */
.chat-layout-container {
  max-width: 100vw;
  overflow: hidden;
  width: 100% !important;
  padding-right: 0 !important;
  margin-right: 0 !important;
}

/* UNIFIED RESPONSIVE LAYOUT SYSTEM - Vercel-inspired approach */

/* Chat area - uses CSS custom properties for dynamic width */
.chat-area {
  width: var(--chat-width, 35%);
  min-width: 320px; /* Absolute minimum for usability */
  max-width: 50%; /* Never exceed half screen */
  flex-shrink: 0;
  overflow: hidden;
  word-wrap: break-word;
  overflow-wrap: break-word;
}

/* Artifact panel - uses CSS custom properties for dynamic width */
.artifact-panel {
  width: var(--artifact-width, calc(100% - var(--chat-width, 35%)));
  min-width: 400px; /* Reduced from 500px for better flexibility */
  flex-grow: 1;
  overflow: hidden;
  word-wrap: break-word;
  overflow-wrap: break-word;
  /* Ensure it reaches the edge */
  margin: 0;
  padding: 0;
}

/* Flex container - Vercel-inspired unified approach */
.chat-flex-container {
  display: flex;
  align-items: stretch;
  width: 100%;
  max-width: 100vw;
  overflow: hidden;
  contain: layout;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  gap: 0;
  margin: 0;
  padding: 0;
  /* Prevent horizontal overflow at all costs */
  box-sizing: border-box;
}

/* Container-based overflow prevention */
.chat-flex-container.has-artifacts {
  /* When artifacts are shown, enforce container constraints */
  min-width: 0; /* Allow shrinking */
  width: 100%;
}

/* Smooth transitions for layout elements */
.chat-area, .artifact-panel {
  transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1),
              min-width 0.3s cubic-bezier(0.4, 0, 0.2, 1),
              max-width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  /* Ensure content doesn't break layout */
  min-width: 0;
  overflow: hidden;
}

/* Prevent content overflow during transitions */
.chat-area > *,
.artifact-panel > * {
  max-width: 100%;
  overflow: hidden;
  box-sizing: border-box;
}

/* Stack layout for very small screens */
@media (max-width: 850px) {
  .chat-flex-container.has-artifacts {
    flex-direction: column;
  }
  
  .chat-area {
    width: 100% !important;
    min-width: 320px;
    max-width: none;
  }
  
  .artifact-panel {
    width: 100% !important;
    min-width: 320px;
    max-width: none;
  }
}

/* Enhanced chat container with horizontal scroll support */
.chat-container {
  min-width: 320px;
  max-width: 100%;
  overflow-x: auto;
  overflow-y: visible;
  /* Smooth horizontal scrolling */
  scroll-behavior: smooth;
  /* Hide scrollbar on webkit browsers but keep functionality */
  scrollbar-width: thin;
  scrollbar-color: hsl(var(--border)) transparent;
}

/* Chat input responsiveness within constrained space */
.chat-area .chat-input-container {
  max-width: 100%;
  width: 100%;
  padding: 0 0.5rem; /* Reduce padding in constrained space */
}

/* Chat input responsiveness within constrained space - Enhanced */
.chat-area .chat-input-form {
  width: 100%;
  max-width: 100%;
  padding: 0 0.5rem;
}

.chat-area .chat-input-textarea {
  min-width: 300px;
  max-width: 100%;
  width: 100%;
  font-size: 0.95rem; /* Slightly smaller in constrained space */
}

/* Domain hints responsive layout in chat area */
.chat-area .domain-hints-container {
  max-width: 100%;
  overflow-x: auto;
  scrollbar-width: thin;
  padding: 0 0.25rem;
}

.chat-area .domain-hints-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 0.375rem;
  justify-content: center;
  min-width: min-content;
}

/* Badge sizing in constrained space */
.chat-area .domain-hint-badge {
  font-size: 0.75rem;
  padding: 0.25rem 0.5rem;
  white-space: nowrap;
  flex-shrink: 0;
}

/* Selected hints display in constrained space */
.chat-area .selected-hints-container {
  max-width: 100%;
  overflow-x: auto;
  scrollbar-width: thin;
  padding: 0 0.25rem;
}

/* Enhanced code block handling for horizontal scroll fix */
.prose pre {
  max-width: 100%;
  overflow-x: auto;
  white-space: pre;
  word-wrap: normal;
  overflow-wrap: normal;
  scrollbar-width: thin;
}

.prose pre::-webkit-scrollbar {
  height: 6px;
}

.prose pre::-webkit-scrollbar-thumb {
  background: hsl(var(--border));
  border-radius: 3px;
}

.prose pre::-webkit-scrollbar-track {
  background: transparent;
}

.prose code {
  word-wrap: break-word;
  overflow-wrap: anywhere;
}

/* Prevent inline code from breaking layout */
.prose :not(pre) > code {
  white-space: nowrap;
  overflow-wrap: normal;
  word-break: normal;
}

/* Responsive text handling for different screen sizes */
@media (max-width: 640px) {
  .message-content {
    font-size: 0.875rem;
    line-height: 1.6;
  }
  
  .prose pre {
    font-size: 0.75rem;
  }
}

/* Table responsiveness in markdown */
.prose table {
  max-width: 100%;
  overflow-x: auto;
  display: block;
  white-space: nowrap;
}

.prose thead,
.prose tbody,
.prose tr {
  display: table;
  width: 100%;
  table-layout: fixed;
}

.prose td,
.prose th {
  word-wrap: break-word;
  overflow-wrap: anywhere;
}

/* Responsive breakpoint adjustments - simplified for desktop-only layout */
@media (min-width: 1440px) {
  .artifact-panel {
    min-width: 500px;
  }
  
  .chat-area {
    min-width: 400px;
  }
}
